---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PageHero from '../../components/PageHero.astro';
---

<BaseLayout title="Join" description="Join the B3 Family Club waitlist.">
  <PageHero
    eyebrow="Join"
    title="B3 Family Club Membership"
    lead="Apply for early access to B3 programming, mentor onboarding, and project showcases."
  />

  <section class="mx-auto grid max-w-6xl gap-8 px-4 py-12 sm:px-6 lg:grid-cols-2 lg:px-8">
    <article class="rounded-2xl border border-white/10 bg-white/5 p-6">
      <h2 class="text-2xl font-black">Program Fit</h2>
      <ul class="mt-4 list-disc space-y-2 pl-5 text-slate-300">
        <li>Kids ages 6-12 who enjoy building, coding, or experimenting</li>
        <li>Parents ready to actively mentor alongside their child</li>
        <li>Families in Cedar Park or the greater Austin area</li>
      </ul>
    </article>
    <article class="rounded-2xl border border-white/10 bg-white/5 p-6">
      <h2 class="text-2xl font-black">Waitlist Form</h2>
      <form
        id="join-waitlist-form"
        class="mt-4 space-y-3"
        action="https://docs.google.com/forms/d/e/1FAIpQLSc5HkTKrghUiqEw6Rj_9hPHPUS3fbj1HwyJz5dkzoxp32KgSg/formResponse"
        method="POST"
        target="google-form-target"
      >
        <input
          class="w-full rounded-lg border border-white/20 bg-slate-900 px-3 py-2 text-white"
          name="entry.2092854462"
          placeholder="Parent name"
          required
        />
        <input
          class="w-full rounded-lg border border-white/20 bg-slate-900 px-3 py-2 text-white"
          type="email"
          name="entry.2015031321"
          placeholder="Email"
          required
        />
        <input
          class="w-full rounded-lg border border-white/20 bg-slate-900 px-3 py-2 text-white"
          type="tel"
          name="entry.759129394"
          placeholder="Phone"
          required
        />
        <input
          class="w-full rounded-lg border border-white/20 bg-slate-900 px-3 py-2 text-white"
          name="entry.2062368422"
          placeholder="Child name"
          required
        />
        <input
          class="w-full rounded-lg border border-white/20 bg-slate-900 px-3 py-2 text-white"
          type="number"
          min="1"
          max="18"
          name="entry.2090411145"
          placeholder="Child age"
          required
        />
        <button class="rounded-full bg-builder px-5 py-2 font-bold text-slate-950" type="submit">Join Waitlist</button>
      </form>
      <iframe name="google-form-target" class="hidden" title="Google Form submission target"></iframe>      
      <div id="join-form-success" class="mt-4 hidden rounded-xl border border-emerald-300/30 bg-emerald-400/10 p-4 text-center">
        <img
          src="/b3-logo.png"
          alt="B3 Club logo"
          class="mx-auto mb-3 h-12 w-12 rounded-full border border-white/20 bg-white/10 p-1"
          loading="lazy"
        />
        <p class="text-base font-bold text-emerald-200">Thank you for joining the waitlist.</p>
      </div>
    </article>
  </section>

  <script>
    const form = document.getElementById('join-waitlist-form');
    const helper = document.getElementById('join-form-helper');
    const success = document.getElementById('join-form-success');
    const iframe = document.querySelector('iframe[name="google-form-target"]');

    form?.addEventListener('submit', (event) => {
      const fields = form.querySelectorAll('input');
      let hasValidationError = false;

      fields.forEach((field) => {
        const value = field.value.trim();
        if (!value) {
          field.setCustomValidity('This field is required.');
          hasValidationError = true;
        } else {
          field.setCustomValidity('');
        }
      });

      if (!form.checkValidity() || hasValidationError) {
        event.preventDefault();
        form.reportValidity();
        success?.classList.add('hidden');
        return;
      }

      form.classList.add('hidden');
      iframe?.classList.add('hidden');
      helper?.classList.add('hidden');
      success?.classList.remove('hidden');
    });
  </script>
</BaseLayout>
